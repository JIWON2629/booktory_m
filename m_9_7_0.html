<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>íŒŒë ›íŠ¸ê´€ë¦¬ - KSI OSP</title>
    <link rel="stylesheet" href="./css/mobile-common.css">
    <style>
        body { background: #f5f5f5; padding-bottom: 70px; }
        .fixed-header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: white; }
        .sub-header { background: white; padding: 10px 15px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #eee; }
        .btn-back { background: none; border: none; font-size: 18px; color: #333; padding: 5px; }
        .sub-header-title { font-size: 17px; font-weight: bold; flex: 1; }
        .legend { display: flex; flex-wrap: wrap; gap: 10px; padding: 8px 15px; background: white; border-bottom: 1px solid #eee; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 10px; color: #666; }
        .legend-dot { width: 10px; height: 10px; border-radius: 2px; border: 2px solid; }
        .legend-dot.empty { background: #f5f5f5; border-color: #ccc; border-style: dashed; }
        .legend-dot.occupied { background: #e8f5e9; border-color: #4caf50; }
        .legend-dot.warning { background: #fff3e0; border-color: #ff9800; }
        .legend-dot.critical { background: #ffebee; border-color: #f44336; }
        .main-content { margin-top: 95px; padding: 12px; }
        .warehouse-title { font-weight: bold; font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .warehouse-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 15px; }
        .pallet-cell { aspect-ratio: 1; background: white; border-radius: 6px; border: 2px solid #e0e0e0; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; position: relative; }
        .pallet-cell.empty { background: #f5f5f5; border-style: dashed; }
        .pallet-cell.empty.selected { border-color: #4caf50; border-style: solid; border-width: 3px; background: #e8f5e9; }
        .pallet-cell.occupied { border-color: #4caf50; background: #e8f5e9; }
        .pallet-cell.occupied.selected { border-color: #1a73e8; border-width: 3px; box-shadow: 0 0 8px rgba(26,115,232,0.3); }
        .pallet-cell.warning { border-color: #ff9800; background: #fff3e0; }
        .pallet-cell.critical { border-color: #f44336; background: #ffebee; }
        .pallet-loc { font-weight: bold; color: #333; font-size: 11px; }
        .pallet-info { font-size: 9px; color: #666; margin-top: 2px; text-align: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 90%; }
        .pallet-qty { font-size: 9px; color: #1a73e8; font-weight: bold; }
        .pallet-status { position: absolute; top: 2px; right: 2px; width: 6px; height: 6px; border-radius: 50%; }
        .pallet-status.normal { background: #4caf50; }
        .pallet-status.warning { background: #ff9800; }
        .pallet-status.critical { background: #f44336; }
        .action-panel { background: white; border-radius: 10px; padding: 12px; margin-bottom: 12px; display: none; }
        .action-panel.show { display: block; }
        .action-title { font-weight: bold; font-size: 13px; margin-bottom: 10px; }
        .selected-info { background: #e3f2fd; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
        .selected-info-row { display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 12px; }
        .selected-info-row:last-child { margin-bottom: 0; }
        .move-section { margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee; }
        .move-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .move-label { width: 60px; font-size: 12px; color: #666; }
        .move-select { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; }
        .action-btns { display: flex; gap: 8px; margin-top: 12px; }
        .action-btns .btn { flex: 1; padding: 10px; border-radius: 6px; font-size: 12px; font-weight: 600; border: 1px solid #ddd; background: white; }
        .action-btns .btn-primary { background: #1a73e8; color: white; border-color: #1a73e8; }
        .action-btns .btn-warning { background: #ff9800; color: white; border-color: #ff9800; }
        .action-btns .btn-success { background: #4caf50; color: white; border-color: #4caf50; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; border-top: 1px solid #eee; z-index: 100; height: 56px; }
        .nav-item { flex: 1; padding: 6px 5px; text-align: center; font-size: 10px; color: #666; text-decoration: none; }
        .nav-icon { font-size: 18px; margin-bottom: 2px; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 300; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: white; width: 90%; max-width: 320px; border-radius: 12px; overflow: hidden; }
        .modal-header { padding: 12px 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 15px; font-weight: bold; }
        .modal-close { background: none; border: none; font-size: 22px; color: #666; }
        .modal-body { padding: 15px; }
        .modal-footer { padding: 12px 15px; border-top: 1px solid #eee; display: flex; gap: 8px; }
        .modal-footer .btn { flex: 1; padding: 10px; border-radius: 6px; font-weight: 600; font-size: 13px; }
        .form-group { margin-bottom: 12px; }
        .form-label { display: block; font-size: 11px; font-weight: 500; color: #666; margin-bottom: 5px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; box-sizing: border-box; }
        .quick-btns { display: flex; gap: 6px; margin-top: 8px; }
        .quick-btns button { flex: 1; padding: 6px; border: 1px solid #ddd; background: #f5f5f5; border-radius: 4px; font-size: 11px; }
        .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 6px; z-index: 400; opacity: 0; transition: opacity 0.3s; font-size: 13px; }
    </style>
</head>
<body>
    <div class="fixed-header">
        <div class="sub-header">
            <button class="btn-back" onclick="location.href='m_9_1_0.html'">â†</button>
            <div class="sub-header-title">ğŸ­ íŒŒë ›íŠ¸ê´€ë¦¬</div>
        </div>
        <div class="legend">
            <div class="legend-item"><div class="legend-dot empty"></div>ë¹ˆ ìë¦¬</div>
            <div class="legend-item"><div class="legend-dot occupied"></div>ì •ìƒ</div>
            <div class="legend-item"><div class="legend-dot warning"></div>ê¸°í•œì„ë°•</div>
            <div class="legend-item"><div class="legend-dot critical"></div>ë§Œë£Œ</div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="warehouse-title">ğŸ­ Aë™ ì°½ê³ </div>
        <div class="warehouse-grid" id="warehouseA"></div>
        
        <div class="warehouse-title">ğŸ­ Bë™ ì°½ê³ </div>
        <div class="warehouse-grid" id="warehouseB"></div>
        
        <!-- ë¹ˆìë¦¬ ì„ íƒ íŒ¨ë„ -->
        <div class="action-panel" id="emptyPanel">
            <div class="action-title">ğŸ“ ë¹ˆ ìë¦¬ ì„ íƒë¨</div>
            <div class="selected-info" id="emptyInfo"></div>
            <div class="action-btns">
                <button class="btn btn-success" onclick="goToInboundEmpty()">ğŸ“¥ ì…ê³ ë“±ë¡</button>
            </div>
        </div>
        
        <!-- í’ˆëª© ì„ íƒ íŒ¨ë„ -->
        <div class="action-panel" id="actionPanel">
            <div class="action-title">ğŸ“¦ ì„ íƒëœ íŒŒë ›íŠ¸</div>
            <div class="selected-info" id="selectedInfo"></div>
            
            <div class="move-section">
                <div class="action-title">ğŸ“ ìœ„ì¹˜ ì´ë™</div>
                <div class="move-row">
                    <span class="move-label">ì´ë™ ìœ„ì¹˜</span>
                    <select class="move-select" id="moveTarget"><option value="">ë¹ˆ ìë¦¬ ì„ íƒ</option></select>
                </div>
                <button class="btn btn-primary" onclick="movePallet()" style="width:100%;padding:10px;border-radius:6px;font-size:13px;font-weight:600;background:#1a73e8;color:white;border:none;">ì´ë™ ì‹¤í–‰</button>
            </div>
            
            <div class="action-btns">
                <button class="btn" onclick="viewDetail()">ìƒì„¸ë³´ê¸°</button>
                <button class="btn btn-warning" onclick="openOutboundModal()">ì¶œê³ ë“±ë¡</button>
            </div>
        </div>
    </div>
    
    <div class="bottom-nav">
        <a href="m_0_0_3.html" class="nav-item"><div class="nav-icon">ğŸ </div>í™ˆ</a>
        <a href="m_3_1_0.html" class="nav-item"><div class="nav-icon">ğŸ“‹</div>ì£¼ë¬¸</a>
        <a href="m_5_1_1.html" class="nav-item"><div class="nav-icon">ğŸ–¨ï¸</div>ì¸ì‡„</a>
        <a href="m_6_1_1.html" class="nav-item"><div class="nav-icon">ğŸ“š</div>ì œë³¸</a>
        <a href="m_7_1_1.html" class="nav-item"><div class="nav-icon">ğŸ“¦</div>ì¶œê³ </a>
    </div>
    
    <!-- ì¶œê³  ëª¨ë‹¬ -->
    <div class="modal-overlay" id="outboundModal">
        <div class="modal">
            <div class="modal-header"><span class="modal-title">ğŸ“¤ ì¶œê³  ìˆ˜ëŸ‰</span><button class="modal-close" onclick="closeModal()">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">í’ˆëª©</label><div id="modalItemName" style="font-weight:bold;"></div></div>
                <div class="form-group"><label class="form-label">í˜„ì¬ ì¬ê³ </label><div id="modalStock" style="color:#1a73e8;font-weight:bold;"></div></div>
                <div class="form-group"><label class="form-label">ì¶œê³  ìˆ˜ëŸ‰ *</label><input type="number" class="form-control" id="outboundQty" placeholder="0"></div>
                <div class="quick-btns">
                    <button onclick="setQtyPercent(25)">25%</button>
                    <button onclick="setQtyPercent(50)">50%</button>
                    <button onclick="setQtyPercent(75)">75%</button>
                    <button onclick="setQtyPercent(100)">ì „ëŸ‰</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal()" style="border:1px solid #ddd;background:white;">ì·¨ì†Œ</button>
                <button class="btn btn-warning" onclick="goToOutbound()" style="background:#ff9800;color:white;border:none;">ì¶œê³ ë“±ë¡</button>
            </div>
        </div>
    </div>

<script>
let selectedPallet = null, selectedEmpty = null;
const palletData = {
    'A-1': { id: '28646', name: 'ë¬¸ë²• íƒ„íƒ„ Writing', customer: 'Abcì¶œíŒì‚¬', qty: 800, deadline: '2025-02-15', status: 'normal' },
    'A-2': { id: '28645', name: 'í•œêµ­ì‚¬ ì—°êµ¬ë°©ë²•ë¡ ', customer: 'ì„œìš¸ëŒ€ì¶œíŒë¶€', qty: 500, deadline: '2025-02-20', status: 'normal' },
    'A-3': { id: '28638', name: 'ë¯¼ë²•ì´ë¡  ê°œì •íŒ', customer: 'ë²•ë¥ ì¶œíŒì‚¬', qty: 1500, deadline: '2025-01-27', status: 'warning' },
    'A-4': null, 'A-5': { id: '28641', name: 'í˜„ëŒ€ë¯¸ìˆ  ë„ë¡', customer: 'ì•„íŠ¸ê°¤ëŸ¬ë¦¬', qty: 500, deadline: '2025-03-01', status: 'normal' },
    'A-6': null, 'A-7': { id: '28639', name: 'í•œêµ­ì–´í•™ ì—°êµ¬ë…¼ì§‘', customer: 'ê°€ë‚˜ë‹¤í•™íšŒ', qty: 500, deadline: '2025-02-28', status: 'normal' }, 'A-8': null,
    'B-1': { id: '28644', name: 'ì„ìƒì˜í•™ í•¸ë“œë¶', customer: 'ë©”ë””í—¬ë¶ìŠ¤', qty: 1000, deadline: '2025-02-10', status: 'normal' },
    'B-2': { id: '28643', name: 'AI í”„ë¡œê·¸ë˜ë° ì…ë¬¸', customer: 'í…Œí¬ë¯¸ë””ì–´', qty: 1000, deadline: '2026-03-10', status: 'normal' },
    'B-3': null, 'B-4': { id: '28634', name: 'ìˆ˜ëŠ¥íŠ¹ê°• êµ­ì–´', customer: 'ì¢‹ì€ì±…ì‹ ì‚¬ê³ ', qty: 3200, deadline: '2025-02-25', status: 'normal' },
    'B-5': { id: '28640', name: '2025 êµìœ¡ë°±ì„œ', customer: 'êµìœ¡ì§„í¥ì›', qty: 2500, deadline: '2025-01-08', status: 'critical' },
    'B-6': null, 'B-7': { id: '28636', name: 'ê³ ë“± ì˜ì–´ ë…í•´', customer: 'ì²œì¬êµìœ¡', qty: 720, deadline: '2025-01-12', status: 'warning' }, 'B-8': null
};

function initPage() { renderWarehouse(); }

function renderWarehouse() { renderGrid('warehouseA', 'A', 8); renderGrid('warehouseB', 'B', 8); }

function renderGrid(containerId, building, count) {
    let html = '';
    for (let i = 1; i <= count; i++) {
        const loc = building + '-' + i;
        const pallet = palletData[loc];
        const isEmpty = !pallet;
        const isSelectedEmpty = selectedEmpty === loc;
        const isSelectedPallet = selectedPallet === loc;
        
        let cellClass = 'pallet-cell';
        if (isEmpty) {
            cellClass += ' empty';
            if (isSelectedEmpty) cellClass += ' selected';
        } else {
            cellClass += ' occupied';
            if (pallet.status === 'warning') cellClass += ' warning';
            if (pallet.status === 'critical') cellClass += ' critical';
            if (isSelectedPallet) cellClass += ' selected';
        }
        
        html += '<div class="' + cellClass + '" onclick="selectCell(\'' + loc + '\')">';
        html += '<div class="pallet-loc">' + loc + '</div>';
        if (pallet) {
            html += '<div class="pallet-info">' + pallet.name.substring(0, 6) + '</div>';
            html += '<div class="pallet-qty">' + pallet.qty.toLocaleString() + 'ë¶€</div>';
            html += '<div class="pallet-status ' + pallet.status + '"></div>';
        } else {
            html += '<div class="pallet-info" style="color:#999;">ë¹ˆ ìë¦¬</div>';
        }
        html += '</div>';
    }
    document.getElementById(containerId).innerHTML = html;
}

function selectCell(loc) {
    const pallet = palletData[loc];
    
    if (!pallet) {
        // ë¹ˆ ìë¦¬ ì„ íƒ
        selectedEmpty = loc;
        selectedPallet = null;
        renderWarehouse();
        showEmptyPanel(loc);
    } else {
        // í’ˆëª© ìˆëŠ” ì…€ ì„ íƒ
        selectedPallet = loc;
        selectedEmpty = null;
        renderWarehouse();
        showActionPanel(loc, pallet);
    }
}

function showEmptyPanel(loc) {
    document.getElementById('actionPanel').classList.remove('show');
    document.getElementById('emptyPanel').classList.add('show');
    document.getElementById('emptyInfo').innerHTML = '<div class="selected-info-row"><span>ìœ„ì¹˜</span><span style="font-weight:bold;">' + loc + '</span></div><div class="selected-info-row"><span>ìƒíƒœ</span><span>ë¹ˆ ìë¦¬</span></div>';
    document.getElementById('emptyPanel').scrollIntoView({ behavior: 'smooth' });
}

function showActionPanel(loc, pallet) {
    document.getElementById('emptyPanel').classList.remove('show');
    document.getElementById('actionPanel').classList.add('show');
    document.getElementById('selectedInfo').innerHTML = 
        '<div class="selected-info-row"><span>ìœ„ì¹˜</span><span style="font-weight:bold;">' + loc + '</span></div>' +
        '<div class="selected-info-row"><span>í’ˆëª©</span><span>' + pallet.name + '</span></div>' +
        '<div class="selected-info-row"><span>ê±°ë˜ì²˜</span><span>' + pallet.customer + '</span></div>' +
        '<div class="selected-info-row"><span>ìˆ˜ëŸ‰</span><span style="color:#1a73e8;font-weight:bold;">' + pallet.qty.toLocaleString() + 'ë¶€</span></div>';
    
    const emptyLocs = Object.keys(palletData).filter(function(l) { return !palletData[l] && l !== loc; });
    document.getElementById('moveTarget').innerHTML = '<option value="">ë¹ˆ ìë¦¬ ì„ íƒ</option>' + emptyLocs.map(function(l) { return '<option value="' + l + '">' + l + '</option>'; }).join('');
    document.getElementById('actionPanel').scrollIntoView({ behavior: 'smooth' });
}

function goToInboundEmpty() {
    if (!selectedEmpty) return;
    location.href = 'm_9_2_0.html?location=' + selectedEmpty;
}

function movePallet() {
    const targetLoc = document.getElementById('moveTarget').value;
    if (!targetLoc) { showToast('ì´ë™í•  ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”'); return; }
    if (!confirm(selectedPallet + ' â†’ ' + targetLoc + 'ë¡œ ì´ë™?')) return;
    palletData[targetLoc] = palletData[selectedPallet];
    palletData[selectedPallet] = null;
    showToast('ì´ë™ ì™„ë£Œ');
    selectedPallet = targetLoc;
    renderWarehouse();
    showActionPanel(targetLoc, palletData[targetLoc]);
}

function viewDetail() {
    if (!selectedPallet) return;
    const p = palletData[selectedPallet];
    alert('í’ˆëª©: ' + p.name + '\nì œì‘ë²ˆí˜¸: ' + p.id + '\nê±°ë˜ì²˜: ' + p.customer + '\nìˆ˜ëŸ‰: ' + p.qty.toLocaleString() + 'ë¶€\në³´ê´€ê¸°í•œ: ' + p.deadline);
}

function openOutboundModal() {
    if (!selectedPallet) return;
    const p = palletData[selectedPallet];
    document.getElementById('modalItemName').textContent = p.name;
    document.getElementById('modalStock').textContent = p.qty.toLocaleString() + 'ë¶€';
    document.getElementById('outboundQty').value = '';
    document.getElementById('outboundModal').classList.add('show');
}

function closeModal() { document.getElementById('outboundModal').classList.remove('show'); }

function setQtyPercent(percent) {
    const p = palletData[selectedPallet];
    if (!p) return;
    document.getElementById('outboundQty').value = Math.floor(p.qty * percent / 100);
}

function goToOutbound() {
    const qty = parseInt(document.getElementById('outboundQty').value);
    const p = palletData[selectedPallet];
    if (!qty || qty <= 0) { showToast('ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
    if (qty > p.qty) { showToast('ì¬ê³  ì´ˆê³¼'); return; }
    const itemData = { id: p.id, name: p.name, customer: p.customer, qty: qty, unit: 'ë¶€', location: selectedPallet };
    location.href = 'm_9_3_0.html?item=' + encodeURIComponent(JSON.stringify(itemData));
}

function showToast(msg) { let t = document.querySelector('.toast'); if (!t) { t = document.createElement('div'); t.className = 'toast'; document.body.appendChild(t); } t.textContent = msg; t.style.opacity = '1'; setTimeout(function() { t.style.opacity = '0'; }, 2000); }
document.addEventListener('DOMContentLoaded', initPage);
</script>
</body>
</html>
