<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì¬ê³ í˜„í™© - KSI OSP</title>
    <link rel="stylesheet" href="./css/mobile-common.css">
    <style>
        body { background: #f5f5f5; padding-bottom: 70px; }
        .header { background: #333; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 0; left: 0; right: 0; z-index: 100; height: 48px; }
        .header-logo { display: flex; align-items: center; gap: 5px; }
        .header-logo .ksi { font-size: 20px; font-weight: bold; color: #1a5dad; font-style: italic; }
        .header-logo .osp { background: #ff6b35; color: white; padding: 2px 6px; font-size: 12px; font-weight: bold; border-radius: 3px; }
        .header-right { display: flex; align-items: center; gap: 12px; }
        .notification-badge { background: #1a73e8; color: white; border-radius: 4px; padding: 4px 10px; font-size: 13px; font-weight: bold; text-decoration: none; }
        .menu-btn { background: none; border: none; color: white; font-size: 26px; padding: 5px; }
        .user-icon { width: 30px; height: 30px; border: 2px solid #666; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .user-icon svg { width: 18px; height: 18px; fill: #999; }
        .page-title { padding: 15px; background: white; border-bottom: 1px solid #eee; margin-top: 48px; }
        .page-title h1 { font-size: 19px; margin: 0; display: flex; align-items: center; gap: 8px; }
        
        /* ìƒˆë¡œìš´ KPI ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .dashboard-cards { padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        
        /* ì™„ì œí’ˆ ë³´ê´€ ì¹´ë“œ (ë„“ì€ ì¹´ë“œ) */
        .storage-card { background: white; border-radius: 12px; padding: 16px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
        .storage-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .storage-card-title { font-size: 15px; font-weight: bold; display: flex; align-items: center; gap: 8px; }
        .storage-card-value { font-size: 24px; font-weight: bold; color: #1a73e8; }
        .storage-progress { height: 12px; background: #e0e0e0; border-radius: 6px; overflow: hidden; margin-bottom: 8px; }
        .storage-progress-fill { height: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a); border-radius: 6px; transition: width 0.3s; }
        .storage-progress-fill.warning { background: linear-gradient(90deg, #ff9800, #ffb74d); }
        .storage-progress-fill.danger { background: linear-gradient(90deg, #f44336, #ef5350); }
        .storage-info { display: flex; justify-content: space-between; font-size: 13px; color: #888; }
        
        /* ì•Œë¦¼ ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .alert-cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .alert-card { background: white; border-radius: 12px; padding: 12px 14px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); cursor: pointer; transition: transform 0.2s; display: flex; align-items: center; gap: 12px; }
        .alert-card:active { transform: scale(0.98); }
        .alert-card-icon { font-size: 24px; flex-shrink: 0; }
        .alert-card-content { flex: 1; min-width: 0; }
        .alert-card-value { font-size: 22px; font-weight: bold; }
        .alert-card-value.danger { color: #f44336; }
        .alert-card-value.warning { color: #ff9800; }
        .alert-card-value.info { color: #1a73e8; }
        .alert-card-label { font-size: 12px; color: #666; }
        .alert-card-sub { font-size: 10px; color: #999; }
        
        /* ê¸ˆì¼ ì…ì¶œê³  ì¹´ë“œ (ë„“ì€ ì¹´ë“œ) */
        .today-card { background: white; border-radius: 12px; padding: 12px 14px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
        .today-card-title { font-size: 14px; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .today-stats { display: flex; gap: 12px; }
        .today-stat { flex: 1; text-align: center; padding: 8px; background: #f8f9fa; border-radius: 8px; }
        .today-stat-icon { font-size: 18px; margin-bottom: 4px; }
        .today-stat-value { font-size: 18px; font-weight: bold; }
        .today-stat-value.in { color: #4caf50; }
        .today-stat-value.out { color: #ff9800; }
        .today-stat-label { font-size: 11px; color: #888; margin-top: 2px; }
        
        .section-title { padding: 15px 15px 10px; font-weight: bold; font-size: 15px; display: flex; justify-content: space-between; align-items: center; }
        .alert-list { padding: 0 15px 15px; }
        .alert-item { background: white; border-radius: 10px; padding: 12px 15px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; border-left: 4px solid #f44336; }
        .alert-item.warning { border-left-color: #ff9800; }
        .alert-item.hidden { display: none; }
        .alert-icon { font-size: 22px; }
        .alert-info { flex: 1; }
        .alert-title { font-weight: 500; font-size: 14px; margin-bottom: 2px; }
        .alert-detail { font-size: 12px; color: #888; }
        .alert-action { padding: 7px 14px; background: #f5f5f5; border: none; border-radius: 6px; font-size: 13px; color: #666; }
        .alert-action:active { background: #e0e0e0; }
        .expand-btn { width: 100%; padding: 10px; background: #f0f0f0; border: none; border-radius: 8px; font-size: 13px; color: #666; display: flex; align-items: center; justify-content: center; gap: 5px; margin-top: 5px; }
        .expand-btn:active { background: #e0e0e0; }
        .expand-btn.hidden { display: none; }
        .quick-menu { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 0 15px 15px; }
        .quick-item { background: white; border-radius: 10px; padding: 15px 10px; text-align: center; text-decoration: none; color: #333; }
        .quick-item:active { background: #f5f5f5; }
        .quick-icon { font-size: 26px; margin-bottom: 6px; }
        .quick-label { font-size: 12px; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; border-top: 1px solid #eee; z-index: 100; height: 56px; }
        .nav-item { flex: 1; padding: 8px 5px; text-align: center; font-size: 11px; color: #666; text-decoration: none; }
        .nav-item.active { color: #1a73e8; }
        .nav-icon { font-size: 20px; margin-bottom: 2px; }
        .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 8px; z-index: 400; opacity: 0; transition: opacity 0.3s; font-size: 14px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-logo"><span class="ksi">KSI</span><span class="osp">OSP</span></div>
        <div class="header-right">
            <a href="#" class="notification-badge">12</a>
            <div class="user-icon"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
            <button class="menu-btn">â˜°</button>
        </div>
    </div>
    
    <div class="page-title"><h1>ğŸ“¦ ì¬ê³ í˜„í™©</h1></div>
    
    <div class="dashboard-cards">
        <!-- ì™„ì œí’ˆ ë³´ê´€ (ì‚¬ìš©ë¥ ) -->
        <div class="storage-card" onclick="location.href='m_9_7_0.html'">
            <div class="storage-card-header">
                <span class="storage-card-title">ğŸ“¦ ì™„ì œí’ˆ ë³´ê´€</span>
                <span class="storage-card-value">72%</span>
            </div>
            <div class="storage-progress">
                <div class="storage-progress-fill warning" style="width: 72%"></div>
            </div>
            <div class="storage-info">
                <span>ì‚¬ìš© ì¤‘: 36 / 50 íŒŒë ›íŠ¸</span>
                <span>ì—¬ìœ : 14 íŒŒë ›íŠ¸</span>
            </div>
        </div>
        
        <!-- ì•Œë¦¼ ì¹´ë“œë“¤ -->
        <div class="alert-cards">
            <div class="alert-card" onclick="location.href='m_9_5_0.html?filter=deadline'">
                <div class="alert-card-icon">â°</div>
                <div class="alert-card-content">
                    <div class="alert-card-label">ë³´ê´€ê¸°í•œ ì„ë°•</div>
                    <div class="alert-card-sub">7ì¼ ì´ë‚´ ë§Œë£Œ</div>
                </div>
                <div class="alert-card-value danger">3</div>
            </div>
            <div class="alert-card" onclick="location.href='m_9_5_0.html?tab=supply&filter=low'">
                <div class="alert-card-icon">ğŸ”§</div>
                <div class="alert-card-content">
                    <div class="alert-card-label">ë¶€ìì¬ ë¶€ì¡±</div>
                    <div class="alert-card-sub">ì•ˆì „ì¬ê³  ë¯¸ë‹¬</div>
                </div>
                <div class="alert-card-value warning">2</div>
            </div>
            <div class="alert-card" onclick="location.href='m_9_5_0.html?tab=packaging&filter=low'">
                <div class="alert-card-icon">ğŸ“¦</div>
                <div class="alert-card-content">
                    <div class="alert-card-label">í¬ì¥ì¬ ë¶€ì¡±</div>
                    <div class="alert-card-sub">ì•ˆì „ì¬ê³  ë¯¸ë‹¬</div>
                </div>
                <div class="alert-card-value warning">1</div>
            </div>
            <div class="alert-card" onclick="location.href='m_9_6_0.html'">
                <div class="alert-card-icon">ğŸ“Š</div>
                <div class="alert-card-content">
                    <div class="alert-card-label">ê¸ˆì¼ ì…ì¶œê³ </div>
                    <div class="alert-card-sub">ì…ê³  4 / ì¶œê³  2</div>
                </div>
                <div class="alert-card-value info">6</div>
            </div>
        </div>
        
        <!-- ê¸ˆì¼ ì…ì¶œê³  ìƒì„¸ -->
        <div class="today-card" onclick="location.href='m_9_6_0.html'">
            <div class="today-card-title">ğŸ“ˆ ê¸ˆì¼ ì…ì¶œê³  í˜„í™©</div>
            <div class="today-stats">
                <div class="today-stat">
                    <div class="today-stat-icon">ğŸ“¥</div>
                    <div class="today-stat-value in">+4</div>
                    <div class="today-stat-label">ì…ê³ </div>
                </div>
                <div class="today-stat">
                    <div class="today-stat-icon">ğŸ“¤</div>
                    <div class="today-stat-value out">-2</div>
                    <div class="today-stat-label">ì¶œê³ </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="section-title">ğŸš¨ ê¸´ê¸‰ ì•Œë¦¼ <span style="font-weight:normal;font-size:13px;color:#888;" id="alertTotalText">0ê±´</span></div>
    <div class="alert-list" id="alertList"></div>
    
    <div class="section-title">âš¡ ë¹ ë¥¸ ë©”ë‰´</div>
    <div class="quick-menu">
        <a href="m_9_2_0.html" class="quick-item"><div class="quick-icon">ğŸ“¥</div><div class="quick-label">ì…ê³ ë“±ë¡</div></a>
        <a href="m_9_3_0.html" class="quick-item"><div class="quick-icon">ğŸ“¤</div><div class="quick-label">ì¶œê³ ë“±ë¡</div></a>
        <a href="m_9_5_0.html" class="quick-item"><div class="quick-icon">ğŸ“‹</div><div class="quick-label">ì¬ê³ ëª©ë¡</div></a>
        <a href="m_9_4_0.html" class="quick-item"><div class="quick-icon">ğŸ›’</div><div class="quick-label">ë°œì£¼ìš”ì²­</div></a>
        <a href="m_9_5_1_0.html" class="quick-item"><div class="quick-icon">ğŸ“Š</div><div class="quick-label">ì¬ê³ ì‹¤ì‚¬</div></a>
        <a href="m_9_8_0.html" class="quick-item"><div class="quick-icon">âš–ï¸</div><div class="quick-label">ì¬ê³ ì¡°ì •</div></a>
        <a href="m_9_6_0.html" class="quick-item"><div class="quick-icon">ğŸ“ˆ</div><div class="quick-label">ì…ì¶œê³ í˜„í™©</div></a>
        <a href="m_9_7_0.html" class="quick-item"><div class="quick-icon">ğŸ­</div><div class="quick-label">íŒŒë ›íŠ¸</div></a>
    </div>
    
    <div class="bottom-nav">
        <a href="m_0_0_3.html" class="nav-item"><div class="nav-icon">ğŸ </div>í™ˆ</a>
        <a href="m_3_1_0.html" class="nav-item"><div class="nav-icon">ğŸ“‹</div>ì£¼ë¬¸</a>
        <a href="m_5_1_1.html" class="nav-item"><div class="nav-icon">ğŸ–¨ï¸</div>ì¸ì‡„</a>
        <a href="m_6_1_1.html" class="nav-item"><div class="nav-icon">ğŸ“š</div>ì œë³¸</a>
        <a href="m_7_1_1.html" class="nav-item"><div class="nav-icon">ğŸ“¦</div>ì¶œê³ </a>
    </div>

<script>
var alertsExpanded = false;
var MAX_VISIBLE_ALERTS = 3;

// ê¸°ë³¸ ì•Œë¦¼ ë°ì´í„°
var baseAlerts = [
    { icon: 'â°', title: 'ë³´ê´€ê¸°í•œ ë§Œë£Œ: 2025 êµìœ¡ë°±ì„œ', detail: 'ì œì‘ë²ˆí˜¸ 28640 Â· 2,500ë¶€', type: 'danger', itemId: '28640' },
    { icon: 'â°', title: 'ë³´ê´€ê¸°í•œ 3ì¼ ì„ë°•: ë¯¼ë²•ì´ë¡ ', detail: 'ì œì‘ë²ˆí˜¸ 28638 Â· 1,500ë¶€', type: 'warning', itemId: '28638' },
    { icon: 'ğŸ“‰', title: 'Magenta ì‰í¬ ë¶€ì¡±', detail: 'í˜„ì¬ 2kg / ì•ˆì „ì¬ê³  5kg', type: 'danger', itemId: 'INK-M' },
    { icon: 'ğŸ“‰', title: 'PUR ì ‘ì°©ì œ ë¶€ì¡±', detail: 'í˜„ì¬ 8kg / ì•ˆì „ì¬ê³  10kg', type: 'danger', itemId: 'ADH-PUR' },
    { icon: 'ğŸ“‰', title: 'ì¤‘í˜• ë°•ìŠ¤ ë¶€ì¡±', detail: 'í˜„ì¬ 45ê°œ / ì•ˆì „ì¬ê³  100ê°œ', type: 'danger', itemId: 'BOX-M' }
];

function initPage() {
    renderAlerts();
}

function renderAlerts() {
    var alerts = [];
    
    // ì¬ê³  ì‹¤ì‚¬ ê²°ê³¼ í™•ì¸
    var stockCheckResult = null;
    try {
        stockCheckResult = JSON.parse(localStorage.getItem('stockCheckResult'));
    } catch(e) {}
    
    // ì‹¤ì‚¬ ê²°ê³¼ê°€ ìˆê³  ì°¨ì´ê°€ ìˆìœ¼ë©´ ìµœìƒë‹¨ì— ì¶”ê°€
    if (stockCheckResult && stockCheckResult.diffCount > 0) {
        alerts.push({
            icon: 'ğŸ“Š',
            title: 'ì¬ê³  ì‹¤ì‚¬ ê²°ê³¼ ë°˜ì˜ í•„ìš”',
            detail: 'ì°¨ì´ ë°œìƒ ' + stockCheckResult.diffCount + 'ê±´ Â· ì‹¤ì‚¬ì¼ ' + stockCheckResult.date,
            type: 'stockcheck',
            action: 'm_9_8_0.html'
        });
    }
    
    // ê¸°ë³¸ ì•Œë¦¼ ì¶”ê°€
    alerts = alerts.concat(baseAlerts);
    
    // ì•Œë¦¼ ë Œë”ë§
    var container = document.getElementById('alertList');
    var html = '';
    
    for (var i = 0; i < alerts.length; i++) {
        var alert = alerts[i];
        var isHidden = i >= MAX_VISIBLE_ALERTS && !alertsExpanded;
        var borderColor = alert.type === 'stockcheck' ? '#9c27b0' : (alert.type === 'warning' ? '#ff9800' : '#f44336');
        var btnStyle = alert.type === 'stockcheck' ? 'background:#9c27b0;color:white;' : '';
        var actionAttr = alert.action ? 'onclick="location.href=\'' + alert.action + '\'"' : 'onclick="goToDetail(\'' + alert.itemId + '\')"';
        
        html += '<div class="alert-item' + (isHidden ? ' hidden' : '') + (alert.type === 'warning' ? ' warning' : '') + '" data-index="' + i + '" style="border-left-color:' + borderColor + ';">' +
            '<div class="alert-icon">' + alert.icon + '</div>' +
            '<div class="alert-info">' +
                '<div class="alert-title">' + alert.title + '</div>' +
                '<div class="alert-detail">' + alert.detail + '</div>' +
            '</div>' +
            '<button class="alert-action" ' + actionAttr + ' style="' + btnStyle + '">ìƒì„¸</button>' +
        '</div>';
    }
    
    // ë”ë³´ê¸° ë²„íŠ¼
    var hiddenCount = alerts.length - MAX_VISIBLE_ALERTS;
    if (hiddenCount > 0) {
        html += '<button class="expand-btn" id="expandBtn" onclick="toggleAlerts()">' +
            '<span id="expandText">' + (alertsExpanded ? 'â–² ì ‘ê¸°' : 'â–¼ ' + hiddenCount + 'ê±´ ë” ë³´ê¸°') + '</span>' +
        '</button>';
    }
    
    container.innerHTML = html;
    document.getElementById('alertTotalText').textContent = alerts.length + 'ê±´';
}

function toggleAlerts() {
    alertsExpanded = !alertsExpanded;
    renderAlerts();
}

function goToDetail(itemId) {
    location.href = 'm_9_5_0.html?detail=' + itemId;
}

document.addEventListener('DOMContentLoaded', initPage);
</script>
</body>
</html>
