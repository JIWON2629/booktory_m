<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë°œì£¼ìš”ì²­ - KSI OSP</title>
    <link rel="stylesheet" href="./css/mobile-common.css">
    <style>
        body { padding-bottom: 130px; background: #f5f5f5; }
        .fixed-header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: white; }
        .sub-header { background: white; padding: 10px 15px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #eee; }
        .btn-back { background: none; border: none; font-size: 18px; color: #333; padding: 5px; }
        .sub-header-title { font-size: 17px; font-weight: bold; flex: 1; }
        .sub-header-actions { display: flex; gap: 6px; align-items: center; }
        .draft-btn { display: flex; align-items: center; gap: 4px; padding: 5px 8px; border: 1px solid #ddd; background: white; border-radius: 6px; font-size: 12px; color: #666; }
        .draft-count { background: #9c27b0; color: white; font-size: 10px; padding: 2px 5px; border-radius: 8px; min-width: 16px; text-align: center; }
        .reset-btn { padding: 5px 8px; font-size: 12px; border: 1px solid #ddd; background: white; border-radius: 6px; color: #666; }
        .tabs { display: flex; background: white; border-bottom: 1px solid #eee; }
        .tab-btn { flex: 1; padding: 12px 8px; border: none; background: none; font-size: 14px; color: #666; font-weight: 500; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #9c27b0; border-bottom-color: #9c27b0; }
        .main-content { margin-top: 95px; padding: 12px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .urgent-banner { background: linear-gradient(135deg, #f44336, #e91e63); color: white; padding: 12px; border-radius: 10px; margin-bottom: 12px; display: flex; align-items: center; gap: 10px; }
        .urgent-banner-icon { font-size: 24px; }
        .urgent-banner-info { flex: 1; }
        .urgent-banner-title { font-weight: bold; margin-bottom: 2px; }
        .urgent-banner-desc { font-size: 11px; opacity: 0.9; }
        .urgent-banner-btn { padding: 8px 12px; background: white; color: #f44336; border: none; border-radius: 6px; font-size: 12px; font-weight: bold; }
        .shortage-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 12px; -webkit-overflow-scrolling: touch; }
        .shortage-item { min-width: 140px; background: white; border-radius: 8px; padding: 10px; border-left: 3px solid #f44336; }
        .shortage-name { font-weight: 500; font-size: 13px; margin-bottom: 4px; }
        .shortage-detail { font-size: 11px; color: #888; margin-bottom: 6px; }
        .shortage-btn { width: 100%; padding: 6px; background: #ffebee; color: #c62828; border: none; border-radius: 4px; font-size: 11px; }
        .card { background: white; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 12px; }
        .card-header { padding: 10px 12px; border-bottom: 1px solid #f0f0f0; font-weight: bold; font-size: 13px; background: #fafafa; }
        .card-body { padding: 12px; }
        .form-group { margin-bottom: 12px; }
        .form-label { display: block; font-size: 11px; font-weight: 500; color: #666; margin-bottom: 5px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; background: white; box-sizing: border-box; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .item-select { display: flex; gap: 8px; }
        .item-select select { flex: 1; }
        .item-select button { padding: 10px 14px; background: #9c27b0; color: white; border: none; border-radius: 6px; font-size: 13px; }
        .order-list { background: white; border-radius: 10px; overflow: hidden; margin-bottom: 12px; }
        .order-list-header { padding: 10px 12px; background: #f3e5f5; font-weight: bold; font-size: 12px; display: flex; justify-content: space-between; }
        .order-item { padding: 10px 12px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 8px; }
        .order-item:last-child { border-bottom: none; }
        .order-item-info { flex: 1; }
        .order-item-name { font-weight: 500; font-size: 13px; }
        .order-item-detail { font-size: 11px; color: #888; }
        .order-item-qty { font-size: 13px; font-weight: bold; color: #9c27b0; }
        .order-item-remove { width: 24px; height: 24px; border: none; background: #ffebee; color: #c62828; border-radius: 50%; font-size: 14px; }
        .summary-card { background: #f3e5f5; border-radius: 10px; padding: 12px; margin-bottom: 12px; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 13px; }
        .summary-row:last-child { margin-bottom: 0; }
        .summary-row.total { font-weight: bold; font-size: 15px; color: #9c27b0; border-top: 1px solid #ce93d8; padding-top: 8px; margin-top: 8px; }
        .fixed-actions { position: fixed; bottom: 56px; left: 0; right: 0; padding: 8px 12px; background: white; border-top: 1px solid #eee; display: flex; gap: 8px; z-index: 90; }
        .fixed-actions .btn { flex: 1; padding: 12px; border-radius: 6px; font-size: 13px; font-weight: 600; border: 1px solid #ddd; background: white; }
        .fixed-actions .btn-purple { background: #9c27b0; color: white; border-color: #9c27b0; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; border-top: 1px solid #eee; z-index: 100; height: 56px; }
        .nav-item { flex: 1; padding: 6px 5px; text-align: center; font-size: 10px; color: #666; text-decoration: none; }
        .nav-icon { font-size: 18px; margin-bottom: 2px; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 300; align-items: flex-end; }
        .modal-overlay.show { display: flex; }
        .modal { background: white; width: 100%; max-height: 70vh; border-radius: 16px 16px 0 0; display: flex; flex-direction: column; }
        .modal-header { padding: 12px 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 15px; font-weight: bold; }
        .modal-close { background: none; border: none; font-size: 22px; color: #666; }
        .modal-body { flex: 1; overflow-y: auto; }
        .modal-footer { padding: 10px 15px; border-top: 1px solid #eee; display: flex; gap: 8px; }
        .draft-list-item { padding: 12px 15px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 10px; }
        .draft-checkbox { width: 20px; height: 20px; border: 2px solid #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; }
        .draft-checkbox.checked { background: #9c27b0; border-color: #9c27b0; color: white; }
        .draft-info { flex: 1; }
        .draft-title { font-weight: 500; font-size: 13px; }
        .draft-date { font-size: 11px; color: #888; }
        .edit-actions { display: none; padding: 10px 15px; background: #f5f5f5; border-top: 1px solid #eee; gap: 8px; }
        .edit-actions.show { display: flex; }
        .empty-state { padding: 30px 20px; text-align: center; color: #888; }
        .empty-icon { font-size: 40px; margin-bottom: 8px; }
        .toast { position: fixed; bottom: 140px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 6px; z-index: 400; opacity: 0; transition: opacity 0.3s; font-size: 13px; }
    </style>
</head>
<body>
    <div class="fixed-header">
        <div class="sub-header">
            <button class="btn-back" onclick="history.back()">â†</button>
            <div class="sub-header-title">ğŸ›’ ë°œì£¼ìš”ì²­</div>
            <div class="sub-header-actions">
                <button class="draft-btn" onclick="openDraftModal()">ì €ì¥ <span class="draft-count" id="draftCount">0</span></button>
                <button class="reset-btn" onclick="resetForm()">ì´ˆê¸°í™”</button>
            </div>
        </div>
        <div class="tabs">
            <button class="tab-btn active" data-tab="supply" onclick="switchTab('supply')">ğŸ”§ ë¶€ìì¬</button>
            <button class="tab-btn" data-tab="packaging" onclick="switchTab('packaging')">ğŸ“¦ í¬ì¥ì¬</button>
        </div>
    </div>
    
    <div class="main-content">
        <!-- ê¸´ê¸‰ ë°œì£¼ ë°°ë„ˆ -->
        <div class="urgent-banner">
            <div class="urgent-banner-icon">ğŸš¨</div>
            <div class="urgent-banner-info">
                <div class="urgent-banner-title">ê¸´ê¸‰ ë°œì£¼ í•„ìš”</div>
                <div class="urgent-banner-desc">ì•ˆì „ì¬ê³  ë¯¸ë‹¬ í’ˆëª© 3ê±´</div>
            </div>
            <button class="urgent-banner-btn" onclick="addAllShortage()">ì „ì²´ ë‹´ê¸°</button>
        </div>
        
        <!-- ë¶€ì¡± í’ˆëª© ìŠ¤í¬ë¡¤ -->
        <div class="shortage-scroll" id="shortageList"></div>
        
        <!-- ë¶€ìì¬ íƒ­ -->
        <div class="tab-content active" id="tab-supply">
            <div class="card">
                <div class="card-header">ë°œì£¼ ì •ë³´</div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">ë°œì£¼ì¼ *</label><input type="date" class="form-control" id="orderDate"></div>
                        <div class="form-group"><label class="form-label">ìš”ì²­ì *</label><select class="form-control" id="requester"><option value="">ì„ íƒ</option><option>ë°•ì°½ê³ </option><option>ê¹€ë¬¼ë¥˜</option></select></div>
                    </div>
                    <div class="form-group"><label class="form-label">í¬ë§ë‚©ê¸°</label><input type="date" class="form-control" id="dueDate"></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">í’ˆëª© ì¶”ê°€</div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">í’ˆëª© ì„ íƒ *</label>
                        <div class="item-select">
                            <select class="form-control" id="supplyItem">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="INK-C" data-price="50000">Cyan ì‰í¬ (1kg/í†µ) - â‚©50,000</option>
                                <option value="INK-M" data-price="50000">Magenta ì‰í¬ (1kg/í†µ) - â‚©50,000</option>
                                <option value="INK-Y" data-price="50000">Yellow ì‰í¬ (1kg/í†µ) - â‚©50,000</option>
                                <option value="INK-K" data-price="45000">Black ì‰í¬ (1kg/í†µ) - â‚©45,000</option>
                                <option value="ADH-HM" data-price="80000">í•«ë©œíŠ¸ ì ‘ì°©ì œ (5kg/í†µ) - â‚©80,000</option>
                                <option value="ADH-PUR" data-price="120000">PUR ì ‘ì°©ì œ (5kg/í†µ) - â‚©120,000</option>
                            </select>
                            <button onclick="addSupplyItem()">ì¶”ê°€</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">ìˆ˜ëŸ‰ *</label><input type="number" class="form-control" id="supplyQty" placeholder="0"></div>
                        <div class="form-group"><label class="form-label">ë‹¨ìœ„</label><input type="text" class="form-control" value="kg" readonly style="background:#f5f5f5;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- í¬ì¥ì¬ íƒ­ -->
        <div class="tab-content" id="tab-packaging">
            <div class="card">
                <div class="card-header">ë°œì£¼ ì •ë³´</div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">ë°œì£¼ì¼ *</label><input type="date" class="form-control" id="packOrderDate"></div>
                        <div class="form-group"><label class="form-label">ìš”ì²­ì *</label><select class="form-control" id="packRequester"><option value="">ì„ íƒ</option><option>ë°•ì°½ê³ </option><option>ê¹€ë¬¼ë¥˜</option></select></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">í’ˆëª© ì¶”ê°€</div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">í’ˆëª© ì„ íƒ *</label>
                        <div class="item-select">
                            <select class="form-control" id="packItem">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="BOX-S" data-price="800">ì†Œí˜• ë°•ìŠ¤ - â‚©800</option>
                                <option value="BOX-M" data-price="1200">ì¤‘í˜• ë°•ìŠ¤ - â‚©1,200</option>
                                <option value="BOX-L" data-price="1800">ëŒ€í˜• ë°•ìŠ¤ - â‚©1,800</option>
                                <option value="AIRCAP" data-price="15000">ì—ì–´ìº¡ (ë¡¤) - â‚©15,000</option>
                                <option value="TAPE-OPP" data-price="3000">OPPí…Œì´í”„ - â‚©3,000</option>
                            </select>
                            <button onclick="addPackItem()">ì¶”ê°€</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">ìˆ˜ëŸ‰ *</label><input type="number" class="form-control" id="packQty" placeholder="0"></div>
                        <div class="form-group"><label class="form-label">ë‹¨ìœ„</label><input type="text" class="form-control" value="ê°œ" readonly style="background:#f5f5f5;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ë°œì£¼ ëª©ë¡ -->
        <div class="order-list" id="orderList" style="display:none;">
            <div class="order-list-header"><span>ğŸ“‹ ë°œì£¼ í’ˆëª©</span><span id="listCount">0ê±´</span></div>
            <div id="orderListBody"></div>
        </div>
        
        <!-- ìš”ì•½ -->
        <div class="summary-card" id="summaryCard" style="display:none;">
            <div class="summary-row"><span>í’ˆëª© ìˆ˜</span><span id="sumItems">0ê±´</span></div>
            <div class="summary-row"><span>ê³µê¸‰ê°€</span><span id="sumSupply">â‚©0</span></div>
            <div class="summary-row"><span>ë¶€ê°€ì„¸</span><span id="sumVat">â‚©0</span></div>
            <div class="summary-row total"><span>í•©ê³„</span><span id="sumTotal">â‚©0</span></div>
        </div>
    </div>
    
    <div class="fixed-actions">
        <button class="btn" onclick="saveDraft()">ì„ì‹œì €ì¥</button>
        <button class="btn btn-purple" onclick="submitOrder()">ğŸ›’ ë°œì£¼ìš”ì²­</button>
    </div>
    
    <div class="bottom-nav">
        <a href="m_0_0_3.html" class="nav-item"><div class="nav-icon">ğŸ </div>í™ˆ</a>
        <a href="m_3_1_0.html" class="nav-item"><div class="nav-icon">ğŸ“‹</div>ì£¼ë¬¸</a>
        <a href="m_5_1_1.html" class="nav-item"><div class="nav-icon">ğŸ–¨ï¸</div>ì¸ì‡„</a>
        <a href="m_6_1_1.html" class="nav-item"><div class="nav-icon">ğŸ“š</div>ì œë³¸</a>
        <a href="m_7_1_1.html" class="nav-item"><div class="nav-icon">ğŸ“¦</div>ì¶œê³ </a>
    </div>
    
    <!-- ì„ì‹œì €ì¥ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="draftModal">
        <div class="modal">
            <div class="modal-header"><span class="modal-title">ì„ì‹œì €ì¥ ëª©ë¡</span><button class="modal-close" onclick="closeModal()">Ã—</button></div>
            <div style="padding:8px 15px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;"><span style="font-size:12px;color:#888;">ì´ <span style="color:#9c27b0;" id="draftTotalCount">0</span>ê°œ ì„ íƒë¨</span><button id="editBtn" onclick="toggleEditMode()" style="padding:5px 10px;border:1px solid #ddd;background:white;border-radius:5px;font-size:12px;">í¸ì§‘</button></div>
            <div class="modal-body" id="draftListBody"></div>
            <div class="edit-actions" id="editActions"><button onclick="deleteAllDrafts()" style="flex:1;padding:10px;border:1px solid #ddd;background:white;border-radius:6px;font-size:13px;">ì „ì²´ ì‚­ì œ</button><button onclick="deleteSelectedDrafts()" style="flex:1;padding:10px;border:1px solid #ddd;background:white;border-radius:6px;font-size:13px;">ì„ íƒ ì‚­ì œ</button></div>
            <div class="modal-footer" id="normalFooter"><button onclick="closeModal()" style="flex:1;padding:10px;border:1px solid #ddd;background:white;border-radius:6px;font-size:13px;">ë‹«ê¸°</button></div>
        </div>
    </div>

<script>
let currentTab = 'supply', orderList = [], drafts = [], editMode = false, selectedDrafts = [];
const shortageItems = [
    { id: 'INK-M', name: 'Magenta ì‰í¬', current: 2, safety: 5, price: 50000, unit: 'kg' },
    { id: 'ADH-PUR', name: 'PUR ì ‘ì°©ì œ', current: 8, safety: 10, price: 120000, unit: 'kg' },
    { id: 'BOX-M', name: 'ì¤‘í˜• ë°•ìŠ¤', current: 45, safety: 100, price: 1200, unit: 'ê°œ' }
];

function initPage() {
    const today = new Date().toISOString().split('T')[0];
    const due = new Date(); due.setDate(due.getDate() + 7);
    document.getElementById('orderDate').value = today;
    document.getElementById('packOrderDate').value = today;
    document.getElementById('dueDate').value = due.toISOString().split('T')[0];
    renderShortageList(); loadDrafts();
}

function switchTab(tab) {
    currentTab = tab;
    document.querySelectorAll('.tab-btn').forEach(function(btn) { btn.classList.toggle('active', btn.dataset.tab === tab); });
    document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.toggle('active', c.id === 'tab-' + tab); });
}

function renderShortageList() {
    document.getElementById('shortageList').innerHTML = shortageItems.map(function(item) {
        return '<div class="shortage-item"><div class="shortage-name">' + item.name + '</div><div class="shortage-detail">í˜„ì¬ ' + item.current + item.unit + ' / ì•ˆì „ ' + item.safety + item.unit + '</div><button class="shortage-btn" onclick="addShortageItem(\'' + item.id + '\')">+ ë‹´ê¸°</button></div>';
    }).join('');
}

function addShortageItem(id) {
    const item = shortageItems.find(function(i) { return i.id === id; });
    if (!item) return;
    const needQty = item.safety - item.current;
    if (orderList.find(function(o) { return o.id === id; })) { showToast('ì´ë¯¸ ì¶”ê°€ë¨'); return; }
    orderList.push({ id: item.id, name: item.name, qty: needQty, unit: item.unit, price: item.price });
    renderOrderList(); showToast('ì¶”ê°€ë¨');
}

function addAllShortage() {
    shortageItems.forEach(function(item) {
        if (!orderList.find(function(o) { return o.id === item.id; })) {
            orderList.push({ id: item.id, name: item.name, qty: item.safety - item.current, unit: item.unit, price: item.price });
        }
    });
    renderOrderList(); showToast('ì „ì²´ ì¶”ê°€ë¨');
}

function addSupplyItem() {
    const sel = document.getElementById('supplyItem');
    const qty = parseInt(document.getElementById('supplyQty').value);
    if (!sel.value || !qty) { showToast('í’ˆëª©ê³¼ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
    const price = parseInt(sel.options[sel.selectedIndex].dataset.price) || 0;
    orderList.push({ id: sel.value, name: sel.options[sel.selectedIndex].text.split(' - ')[0], qty: qty, unit: 'kg', price: price });
    sel.value = ''; document.getElementById('supplyQty').value = '';
    renderOrderList(); showToast('ì¶”ê°€ë¨');
}

function addPackItem() {
    const sel = document.getElementById('packItem');
    const qty = parseInt(document.getElementById('packQty').value);
    if (!sel.value || !qty) { showToast('í’ˆëª©ê³¼ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
    const price = parseInt(sel.options[sel.selectedIndex].dataset.price) || 0;
    orderList.push({ id: sel.value, name: sel.options[sel.selectedIndex].text.split(' - ')[0], qty: qty, unit: 'ê°œ', price: price });
    sel.value = ''; document.getElementById('packQty').value = '';
    renderOrderList(); showToast('ì¶”ê°€ë¨');
}

function renderOrderList() {
    const l = document.getElementById('orderList'), s = document.getElementById('summaryCard');
    if (orderList.length === 0) { l.style.display = 'none'; s.style.display = 'none'; return; }
    l.style.display = 'block'; s.style.display = 'block';
    document.getElementById('listCount').textContent = orderList.length + 'ê±´';
    document.getElementById('orderListBody').innerHTML = orderList.map(function(item, idx) {
        return '<div class="order-item"><div class="order-item-info"><div class="order-item-name">' + item.name + '</div><div class="order-item-detail">' + item.id + ' Â· â‚©' + item.price.toLocaleString() + '/' + item.unit + '</div></div><span class="order-item-qty">' + item.qty + item.unit + '</span><button class="order-item-remove" onclick="removeItem(' + idx + ')">Ã—</button></div>';
    }).join('');
    
    let supply = 0; orderList.forEach(function(i) { supply += i.qty * i.price; });
    const vat = Math.round(supply * 0.1);
    document.getElementById('sumItems').textContent = orderList.length + 'ê±´';
    document.getElementById('sumSupply').textContent = 'â‚©' + supply.toLocaleString();
    document.getElementById('sumVat').textContent = 'â‚©' + vat.toLocaleString();
    document.getElementById('sumTotal').textContent = 'â‚©' + (supply + vat).toLocaleString();
}

function removeItem(idx) { orderList.splice(idx, 1); renderOrderList(); }
function resetForm() { if (!confirm('ì´ˆê¸°í™”?')) return; orderList = []; renderOrderList(); showToast('ì´ˆê¸°í™”'); }
function closeModal() { document.getElementById('draftModal').classList.remove('show'); }

function loadDrafts() { try { drafts = JSON.parse(localStorage.getItem('orderDrafts') || '[]'); } catch(e) { drafts = []; } document.getElementById('draftCount').textContent = drafts.length; }
function saveDraft() {
    if (orderList.length === 0) { showToast('ì €ì¥í•  í•­ëª© ì—†ìŒ'); return; }
    drafts.unshift({ id: Date.now(), date: new Date().toLocaleString('ko-KR'), title: orderList[0].name + (orderList.length > 1 ? ' ì™¸ ' + (orderList.length-1) + 'ê±´' : ''), items: [...orderList] });
    localStorage.setItem('orderDrafts', JSON.stringify(drafts)); document.getElementById('draftCount').textContent = drafts.length; showToast('ì„ì‹œì €ì¥ ì™„ë£Œ');
}
function openDraftModal() { editMode = false; selectedDrafts = []; renderDraftList(); document.getElementById('draftModal').classList.add('show'); document.getElementById('editActions').classList.remove('show'); document.getElementById('normalFooter').style.display = 'flex'; document.getElementById('editBtn').textContent = 'í¸ì§‘'; }
function renderDraftList() {
    document.getElementById('draftTotalCount').textContent = selectedDrafts.length;
    if (drafts.length === 0) { document.getElementById('draftListBody').innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“„</div><div>ì„ì‹œì €ì¥ëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤</div></div>'; return; }
    document.getElementById('draftListBody').innerHTML = drafts.map(function(d) { const isSel = selectedDrafts.includes(d.id); return '<div class="draft-list-item" onclick="' + (editMode ? 'toggleDraftSelection(' + d.id + ')' : 'loadDraft(' + d.id + ')') + '">' + (editMode ? '<div class="draft-checkbox ' + (isSel ? 'checked' : '') + '">' + (isSel ? 'âœ“' : '') + '</div>' : '') + '<div class="draft-info"><div class="draft-title">' + d.title + '</div><div class="draft-date">' + d.date + '</div></div></div>'; }).join('');
}
function toggleEditMode() { editMode = !editMode; selectedDrafts = []; document.getElementById('editBtn').textContent = editMode ? 'ì™„ë£Œ' : 'í¸ì§‘'; document.getElementById('editActions').classList.toggle('show', editMode); document.getElementById('normalFooter').style.display = editMode ? 'none' : 'flex'; renderDraftList(); }
function toggleDraftSelection(id) { const idx = selectedDrafts.indexOf(id); if (idx > -1) selectedDrafts.splice(idx, 1); else selectedDrafts.push(id); renderDraftList(); }
function deleteAllDrafts() { if (!confirm('ëª¨ë‘ ì‚­ì œ?')) return; drafts = []; localStorage.setItem('orderDrafts', '[]'); document.getElementById('draftCount').textContent = 0; renderDraftList(); }
function deleteSelectedDrafts() { if (!selectedDrafts.length) return; drafts = drafts.filter(function(d) { return !selectedDrafts.includes(d.id); }); selectedDrafts = []; localStorage.setItem('orderDrafts', JSON.stringify(drafts)); document.getElementById('draftCount').textContent = drafts.length; renderDraftList(); }
function loadDraft(id) { const d = drafts.find(function(x) { return x.id === id; }); if (d) { orderList = d.items || []; renderOrderList(); closeModal(); showToast('ë¶ˆëŸ¬ì˜´'); } }

function submitOrder() { if (!orderList.length) { showToast('í’ˆëª© ì¶”ê°€ í•„ìš”'); return; } if (!confirm('ë°œì£¼ ìš”ì²­?')) return; showToast('ë°œì£¼ ì™„ë£Œ!'); orderList = []; renderOrderList(); setTimeout(function() { location.href = 'm_9_1_0.html'; }, 800); }
function showToast(msg) { let t = document.querySelector('.toast'); if (!t) { t = document.createElement('div'); t.className = 'toast'; document.body.appendChild(t); } t.textContent = msg; t.style.opacity = '1'; setTimeout(function() { t.style.opacity = '0'; }, 2000); }
document.addEventListener('DOMContentLoaded', initPage);
</script>
</body>
</html>
