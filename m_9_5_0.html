<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì¬ê³ ëª©ë¡ - KSI OSP</title>
    <link rel="stylesheet" href="./css/mobile-common.css">
    <style>
        body { background: #f5f5f5; padding-bottom: 70px; }
        .fixed-header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: white; }
        .sub-header { position: relative; background: white; padding: 10px 15px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #eee; }
        .btn-back { background: none; border: none; font-size: 20px; color: #333; padding: 5px; }
        .sub-header-title { font-size: 17px; font-weight: bold; flex: 1; }
        .sub-header-actions { display: flex; gap: 8px; }
        .select-btn { padding: 6px 12px; border: 1px solid #ddd; background: white; border-radius: 6px; font-size: 13px; color: #666; }
        .select-btn.active { background: #1a73e8; color: white; border-color: #1a73e8; }
        .tabs { display: flex; background: white; border-bottom: 1px solid #eee; }
        .tab-btn { flex: 1; padding: 12px 8px; border: none; background: none; font-size: 14px; color: #666; font-weight: 500; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #1a73e8; border-bottom-color: #1a73e8; }
        .search-filter { background: white; padding: 10px 12px; border-bottom: 1px solid #eee; }
        .filter-row { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
        .filter-btn { padding: 6px 12px; border: 1px solid #ddd; background: white; border-radius: 14px; font-size: 13px; color: #666; }
        .filter-btn.active { background: #1a73e8; color: white; border-color: #1a73e8; }
        .main-content { margin-top: 180px; padding: 15px; }
        .main-content.select-mode { padding-bottom: 80px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .stock-card { background: white; border-radius: 10px; padding: 14px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); position: relative; }
        .stock-card.selected { border: 2px solid #1a73e8; background: #e3f2fd; }
        .stock-card-checkbox { position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; border: 2px solid #ddd; border-radius: 50%; display: none; align-items: center; justify-content: center; background: white; }
        .stock-card-checkbox.show { display: flex; }
        .stock-card-checkbox.checked { background: #1a73e8; border-color: #1a73e8; color: white; }
        .stock-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; padding-right: 30px; }
        .stock-card-title { font-weight: bold; font-size: 15px; margin-bottom: 3px; }
        .stock-card-subtitle { font-size: 13px; color: #888; }
        .stock-card-badge { padding: 4px 8px; border-radius: 10px; font-size: 12px; font-weight: 500; position: absolute; top: 14px; right: 14px; }
        .stock-card-badge.normal { background: #e8f5e9; color: #2e7d32; }
        .stock-card-badge.low { background: #fff3e0; color: #e65100; }
        .stock-card-badge.critical { background: #ffebee; color: #c62828; }
        .stock-card-badge.deadline { background: #fce4ec; color: #c2185b; }
        .stock-card-info { display: flex; gap: 15px; margin-bottom: 12px; font-size: 14px; }
        .stock-info-item { display: flex; align-items: center; gap: 5px; }
        .stock-info-label { color: #888; }
        .stock-info-value { font-weight: 500; }
        .stock-card-actions { display: flex; gap: 8px; }
        .stock-card-actions .btn { flex: 1; padding: 9px; font-size: 13px; border-radius: 6px; border: 1px solid #ddd; background: white; color: #333; }
        .stock-card-actions .btn-primary { background: #1a73e8; color: #ffffff !important; border-color: #1a73e8; }
        .stock-card-actions .btn-warning { background: #ff9800; color: #ffffff !important; border-color: #ff9800; }
        .stock-card-actions .btn-success { background: #4caf50; color: #ffffff !important; border-color: #4caf50; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; border-top: 1px solid #eee; z-index: 100; height: 56px; }
        .nav-item { flex: 1; padding: 8px 5px; text-align: center; font-size: 11px; color: #666; text-decoration: none; }
        .nav-icon { font-size: 20px; margin-bottom: 2px; }
        
        .fab-container { position: fixed; bottom: 75px; right: 15px; z-index: 90; }
        .fab-btn { width: 54px; height: 54px; border-radius: 50%; background: #1a73e8; color: white; border: none; font-size: 26px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: transform 0.3s; }
        .fab-btn.open { transform: rotate(45deg); }
        .fab-menu { position: absolute; bottom: 64px; right: 0; display: none; flex-direction: column; gap: 10px; align-items: flex-end; }
        .fab-menu.show { display: flex; }
        .fab-menu-item { display: flex; align-items: center; gap: 8px; padding: 12px 16px; background: white; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); white-space: nowrap; font-size: 14px; animation: fadeIn 0.2s; cursor: pointer; }
        .fab-menu-item:active { background: #f5f5f5; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .select-actions { position: fixed; bottom: 56px; left: 0; right: 0; background: white; border-top: 1px solid #eee; padding: 10px 12px; display: none; gap: 8px; z-index: 95; }
        .select-actions.show { display: flex; }
        .select-actions .btn { flex: 1; padding: 11px 8px; font-size: 12px; border-radius: 6px; font-weight: 600; }
        .select-count { font-size: 13px; color: #666; padding: 8px 0; text-align: center; }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 300; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: white; width: 90%; max-width: 340px; border-radius: 12px; overflow: hidden; }
        .modal-header { padding: 14px 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 17px; font-weight: bold; }
        .modal-close { background: none; border: none; font-size: 24px; color: #666; }
        .modal-body { padding: 15px; max-height: 60vh; overflow-y: auto; }
        .modal-footer { padding: 12px 15px; border-top: 1px solid #eee; display: flex; gap: 8px; }
        .modal-footer .btn { flex: 1; padding: 12px; border-radius: 6px; font-weight: 600; font-size: 14px; border: 1px solid #ddd; background: white; color: #333; }
        .modal-footer .btn-success { background: #4caf50; color: #fff !important; border-color: #4caf50; }
        .modal-footer .btn-primary { background: #1a73e8; color: #fff !important; border-color: #1a73e8; }
        .modal-footer .btn-warning { background: #ff9800; color: #fff !important; border-color: #ff9800; }
        .detail-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { color: #666; }
        .detail-value { font-weight: 500; }
        .form-group { margin-bottom: 14px; }
        .form-label { display: block; font-size: 13px; font-weight: 500; color: #666; margin-bottom: 6px; }
        .form-control { width: 100%; padding: 11px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px; box-sizing: border-box; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .empty-state { padding: 40px 20px; text-align: center; color: #888; }
        .empty-icon { font-size: 48px; margin-bottom: 10px; }
        .toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 6px; z-index: 400; opacity: 0; transition: opacity 0.3s; font-size: 14px; }
    </style>
</head>
<body>
    <div class="fixed-header">
        <div class="sub-header">
            <button class="btn-back" onclick="location.href='m_9_1_0.html'">â†</button>
            <div class="sub-header-title">ğŸ“‹ ì¬ê³ ëª©ë¡</div>
            <div class="sub-header-actions">
                <button class="select-btn" id="selectModeBtn" onclick="toggleSelectMode()">ì„ íƒ</button>
            </div>
        </div>
        <div class="tabs">
            <button class="tab-btn active" data-tab="product" onclick="switchTab('product')">ğŸ“¦ ì™„ì œí’ˆ</button>
            <button class="tab-btn" data-tab="supply" onclick="switchTab('supply')">ğŸ”§ ë¶€ìì¬</button>
            <button class="tab-btn" data-tab="packaging" onclick="switchTab('packaging')">ğŸ“¦ í¬ì¥ì¬</button>
        </div>
        <div class="search-filter">
            <input type="text" class="form-control" id="searchInput" placeholder="ğŸ” í’ˆëª©ì½”ë“œ, í’ˆëª…, ê±°ë˜ì²˜ ê²€ìƒ‰" oninput="filterStock()" style="padding:10px 12px;font-size:15px;">
            <div class="filter-row" id="filterRow">
                <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">ì „ì²´</button>
                <button class="filter-btn" data-filter="normal" onclick="setFilter('normal')">ì •ìƒ</button>
                <button class="filter-btn" data-filter="low" onclick="setFilter('low')">ë¶€ì¡±</button>
                <button class="filter-btn" data-filter="critical" onclick="setFilter('critical')">ê¸´ê¸‰</button>
                <button class="filter-btn" data-filter="deadline" onclick="setFilter('deadline')">ê¸°í•œì„ë°•</button>
            </div>
        </div>
    </div>
    
    <div class="main-content" id="mainContent">
        <div class="tab-content active" id="tab-product"><div id="productList"></div></div>
        <div class="tab-content" id="tab-supply"><div id="supplyList"></div></div>
        <div class="tab-content" id="tab-packaging"><div id="packagingList"></div></div>
    </div>
    
    <div class="fab-container" id="fabContainer">
        <div class="fab-menu" id="fabMenu">
            <div class="fab-menu-item" onclick="openQuickAdd()">ğŸ“¦ ë¹ ë¥¸ í’ˆëª© ë“±ë¡</div>
        </div>
        <button class="fab-btn" id="fabBtn" onclick="toggleFab()">+</button>
    </div>
    
    <div class="select-actions" id="selectActions">
        <button class="btn btn-success" onclick="bulkMove()">ğŸ”„ ì´ë™</button>
        <button class="btn btn-warning" onclick="bulkOutbound()">ğŸ“¤ ì¶œê³ </button>
        <button class="btn btn-primary" onclick="bulkDeadline()">ğŸ“… ê¸°í•œìˆ˜ì •</button>
    </div>
    
    <div class="bottom-nav">
        <a href="m_0_0_3.html" class="nav-item"><div class="nav-icon">ğŸ </div>í™ˆ</a>
        <a href="m_3_1_0.html" class="nav-item"><div class="nav-icon">ğŸ“‹</div>ì£¼ë¬¸</a>
        <a href="m_5_1_1.html" class="nav-item"><div class="nav-icon">ğŸ–¨ï¸</div>ì¸ì‡„</a>
        <a href="m_6_1_1.html" class="nav-item"><div class="nav-icon">ğŸ“š</div>ì œë³¸</a>
        <a href="m_7_1_1.html" class="nav-item"><div class="nav-icon">ğŸ“¦</div>ì¶œê³ </a>
    </div>
    
    <!-- ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header"><span class="modal-title">ğŸ“¦ í’ˆëª© ìƒì„¸</span><button class="modal-close" onclick="closeModal('detailModal')">Ã—</button></div>
            <div class="modal-body" id="detailContent"></div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="goToMoveFromModal()">ì´ë™</button>
                <button class="btn btn-primary" onclick="goToInboundFromModal()">ì…ê³ </button>
                <button class="btn btn-warning" onclick="goToOutboundFromModal()">ì¶œê³ </button>
            </div>
        </div>
    </div>
    
    <!-- ë‹¨ì¼ í’ˆëª© ìœ„ì¹˜ ì´ë™ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="singleMoveModal">
        <div class="modal">
            <div class="modal-header"><span class="modal-title">ğŸ”„ ìœ„ì¹˜ ì´ë™</span><button class="modal-close" onclick="closeModal('singleMoveModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">í’ˆëª©ëª…</label>
                    <div id="singleMoveItemName" style="font-weight:bold;font-size:15px;padding:8px 0;"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">í˜„ì¬ ìœ„ì¹˜</label>
                    <div id="singleMoveCurrentLoc" style="color:#888;padding:8px 0;"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì´ë™í•  ìœ„ì¹˜ *</label>
                    <select class="form-control" id="singleMoveLocation">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="A-1-1">Aë™ 1êµ¬ì—­ 1ì—´</option>
                        <option value="A-1-2">Aë™ 1êµ¬ì—­ 2ì—´</option>
                        <option value="A-2-1">Aë™ 2êµ¬ì—­ 1ì—´</option>
                        <option value="A-2-2">Aë™ 2êµ¬ì—­ 2ì—´</option>
                        <option value="A-3-1">Aë™ 3êµ¬ì—­ 1ì—´</option>
                        <option value="A-3-2">Aë™ 3êµ¬ì—­ 2ì—´</option>
                        <option value="B-1-1">Bë™ 1êµ¬ì—­ 1ì—´</option>
                        <option value="B-2-1">Bë™ 2êµ¬ì—­ 1ì—´</option>
                        <option value="B-5-1">Bë™ 5êµ¬ì—­ 1ì—´</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('singleMoveModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="confirmSingleMove()">ì´ë™</button>
            </div>
        </div>
    </div>
    
    <!-- ë¹ ë¥¸ í’ˆëª© ë“±ë¡ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="quickAddModal">
        <div class="modal">
            <div class="modal-header"><span class="modal-title">ğŸ“¦ ë¹ ë¥¸ í’ˆëª© ë“±ë¡</span><button class="modal-close" onclick="closeModal('quickAddModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">í’ˆëª© ìœ í˜• *</label>
                    <select class="form-control" id="quickType">
                        <option value="product">ì™„ì œí’ˆ</option>
                        <option value="supply">ë¶€ìì¬</option>
                        <option value="packaging">í¬ì¥ì¬</option>
                    </select>
                </div>
                <div class="form-group"><label class="form-label">í’ˆëª©ëª… *</label><input type="text" class="form-control" id="quickName" placeholder="í’ˆëª©ëª… ì…ë ¥"></div>
                <div class="form-group"><label class="form-label">ISBN / ì œì‘ë²ˆí˜¸ / ë°”ì½”ë“œ</label><input type="text" class="form-control" id="quickCode" placeholder="ì½”ë“œ ì…ë ¥"></div>
                <div class="form-group" id="quickCustomerGroup"><label class="form-label">ê±°ë˜ì²˜</label><input type="text" class="form-control" id="quickCustomer" placeholder="ê±°ë˜ì²˜ ì…ë ¥"></div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                    <div class="form-group"><label class="form-label">ìˆ˜ëŸ‰ *</label><input type="number" class="form-control" id="quickQty" placeholder="0"></div>
                    <div class="form-group"><label class="form-label">ë‹¨ìœ„</label>
                        <select class="form-control" id="quickUnit">
                            <option value="ë¶€">ë¶€</option>
                            <option value="kg">kg</option>
                            <option value="ê°œ">ê°œ</option>
                            <option value="L">L</option>
                            <option value="ë¡¤">ë¡¤</option>
                            <option value="ì¥">ì¥</option>
                            <option value="í†µ">í†µ</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ë³´ê´€ìœ„ì¹˜</label>
                    <div class="form-row">
                        <select class="form-control" id="quickLocBuilding">
                            <option value="">ë™</option>
                            <option value="A">Aë™</option>
                            <option value="B">Bë™</option>
                        </select>
                        <select class="form-control" id="quickLocZone">
                            <option value="">êµ¬ì—­</option>
                            <option value="1">1êµ¬ì—­</option>
                            <option value="2">2êµ¬ì—­</option>
                            <option value="3">3êµ¬ì—­</option>
                            <option value="4">4êµ¬ì—­</option>
                            <option value="5">5êµ¬ì—­</option>
                        </select>
                        <select class="form-control" id="quickLocShelf">
                            <option value="">ì„ ë°˜</option>
                            <option value="1">1ì—´</option>
                            <option value="2">2ì—´</option>
                            <option value="3">3ì—´</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('quickAddModal')">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="submitQuickAdd()">ë“±ë¡</button>
            </div>
        </div>
    </div>
    
    <!-- ì¼ê´„ ì´ë™ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="bulkMoveModal">
        <div class="modal">
            <div class="modal-header"><span class="modal-title">ğŸ”„ ì¼ê´„ ìœ„ì¹˜ ì´ë™</span><button class="modal-close" onclick="closeModal('bulkMoveModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="select-count" id="moveCount">0ê±´ ì„ íƒë¨</div>
                <div class="form-group">
                    <label class="form-label">ì´ë™í•  ìœ„ì¹˜ *</label>
                    <select class="form-control" id="bulkMoveLocation">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="A-1">Aë™ 1êµ¬ì—­</option>
                        <option value="A-2">Aë™ 2êµ¬ì—­</option>
                        <option value="A-3">Aë™ 3êµ¬ì—­</option>
                        <option value="B-1">Bë™ 1êµ¬ì—­</option>
                        <option value="B-2">Bë™ 2êµ¬ì—­</option>
                        <option value="B-3">Bë™ 3êµ¬ì—­</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('bulkMoveModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="confirmBulkMove()">ì´ë™</button>
            </div>
        </div>
    </div>
    
    <!-- ì¼ê´„ ì¶œê³  ëª¨ë‹¬ -->
    <div class="modal-overlay" id="bulkOutModal">
        <div class="modal">
            <div class="modal-header"><span class="modal-title">ğŸ“¤ ì¼ê´„ ì¶œê³ </span><button class="modal-close" onclick="closeModal('bulkOutModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="select-count" id="outCount">0ê±´ ì„ íƒë¨</div>
                <div class="form-group">
                    <label class="form-label">ì¶œê³ ìœ í˜• *</label>
                    <select class="form-control" id="bulkOutType">
                        <option value="ê³ ê°ì¶œê³ ">ê³ ê°ì¶œê³ </option>
                        <option value="ìƒ˜í”Œì¶œê³ ">ìƒ˜í”Œì¶œê³ </option>
                        <option value="ë‚´ë¶€ì´ë™">ë‚´ë¶€ì´ë™</option>
                        <option value="íê¸°">íê¸°</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('bulkOutModal')">ì·¨ì†Œ</button>
                <button class="btn btn-warning" onclick="confirmBulkOut()">ì¶œê³ </button>
            </div>
        </div>
    </div>
    
    <!-- ì¼ê´„ ê¸°í•œ ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal-overlay" id="bulkDeadlineModal">
        <div class="modal">
            <div class="modal-header"><span class="modal-title">ğŸ“… ì¼ê´„ ê¸°í•œ ìˆ˜ì •</span><button class="modal-close" onclick="closeModal('bulkDeadlineModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="select-count" id="deadlineCount">0ê±´ ì„ íƒë¨</div>
                <div class="form-group">
                    <label class="form-label">ìƒˆë¡œìš´ ë³´ê´€ê¸°í•œ *</label>
                    <input type="date" class="form-control" id="bulkDeadlineDate">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('bulkDeadlineModal')">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="confirmBulkDeadline()">ìˆ˜ì •</button>
            </div>
        </div>
    </div>

<script>
var currentTab = 'product', currentFilter = 'all', selectedItem = null, fabOpen = false;
var selectMode = false, selectedItems = [];
var moveTargetItemId = null;

var productData = [
    { id: '28646', name: 'ë¬¸ë²• íƒ„íƒ„ Writing 2', customer: 'Abcì¶œíŒì‚¬', stock: 800, unit: 'ë¶€', location: 'A-1-2', deadline: '2025-02-15', status: 'normal' },
    { id: '28645', name: 'í•œêµ­ì‚¬ ì—°êµ¬ë°©ë²•ë¡ ', customer: 'ì„œìš¸ëŒ€ì¶œíŒë¶€', stock: 500, unit: 'ë¶€', location: 'A-2-1', deadline: '2025-02-20', status: 'normal' },
    { id: '28640', name: '2025 êµìœ¡ë°±ì„œ', customer: 'êµìœ¡ì§„í¥ì›', stock: 2500, unit: 'ë¶€', location: 'B-5-1', deadline: '2025-01-08', status: 'deadline' },
    { id: '28638', name: 'ë¯¼ë²•ì´ë¡  ê°œì •íŒ', customer: 'ë²•ë¥ ì¶œíŒì‚¬', stock: 1500, unit: 'ë¶€', location: 'A-3-2', deadline: '2025-01-12', status: 'deadline' },
    { id: '28635', name: 'ìˆ˜ëŠ¥íŠ¹ê°• êµ­ì–´ì˜ì—­', customer: 'EBS', stock: 3200, unit: 'ë¶€', location: 'A-1-1', deadline: '2025-01-15', status: 'deadline' }
];

var supplyData = [
    { id: 'INK-C', name: 'Cyan ì‰í¬', stock: 12, safety: 5, unit: 'kg', location: 'B-1-1', status: 'normal' },
    { id: 'INK-M', name: 'Magenta ì‰í¬', stock: 2, safety: 5, unit: 'kg', location: 'B-1-1', status: 'low' },
    { id: 'INK-Y', name: 'Yellow ì‰í¬', stock: 15, safety: 5, unit: 'kg', location: 'B-1-2', status: 'normal' },
    { id: 'INK-K', name: 'Black ì‰í¬', stock: 8, safety: 10, unit: 'kg', location: 'B-1-2', status: 'normal' },
    { id: 'ADH-PUR', name: 'PUR ì ‘ì°©ì œ', stock: 8, safety: 10, unit: 'kg', location: 'B-2-1', status: 'low' },
    { id: 'ADH-HM', name: 'í•«ë©œíŠ¸ ì ‘ì°©ì œ', stock: 25, safety: 10, unit: 'kg', location: 'B-2-1', status: 'normal' },
    { id: 'COAT-G', name: 'ê´‘íƒ ì½”íŒ…ì•¡', stock: 18, safety: 8, unit: 'L', location: 'B-2-2', status: 'normal' },
    { id: 'COAT-M', name: 'ë¬´ê´‘ ì½”íŒ…ì•¡', stock: 5, safety: 8, unit: 'L', location: 'B-2-2', status: 'low' }
];

var packagingData = [
    { id: 'BOX-S', name: 'ì†Œí˜• ë°•ìŠ¤', stock: 250, safety: 100, unit: 'ê°œ', location: 'A-3-1', status: 'normal' },
    { id: 'BOX-M', name: 'ì¤‘í˜• ë°•ìŠ¤', stock: 45, safety: 100, unit: 'ê°œ', location: 'A-3-1', status: 'low' },
    { id: 'BOX-L', name: 'ëŒ€í˜• ë°•ìŠ¤', stock: 120, safety: 50, unit: 'ê°œ', location: 'A-3-2', status: 'normal' },
    { id: 'TAPE-B', name: 'í¬ì¥í…Œì´í”„(ê°ˆìƒ‰)', stock: 80, safety: 30, unit: 'ë¡¤', location: 'A-3-3', status: 'normal' },
    { id: 'TAPE-T', name: 'í¬ì¥í…Œì´í”„(íˆ¬ëª…)', stock: 25, safety: 30, unit: 'ë¡¤', location: 'A-3-3', status: 'low' },
    { id: 'WRAP-S', name: 'ìŠ¤íŠ¸ë ˆì¹˜í•„ë¦„', stock: 45, safety: 20, unit: 'ë¡¤', location: 'A-4-1', status: 'normal' },
    { id: 'BUBBLE', name: 'ì—ì–´ìº¡(ë½ë½ì´)', stock: 15, safety: 10, unit: 'ë¡¤', location: 'A-4-1', status: 'normal' },
    { id: 'PAD-P', name: 'ì¢…ì´ì™„ì¶©ì¬', stock: 200, safety: 100, unit: 'ì¥', location: 'A-4-2', status: 'normal' }
];

function initPage() {
    // ì¬ê³ ì¡°ì • ê²°ê³¼ ë°˜ì˜
    applyAdjustments();
    
    var urlParams = new URLSearchParams(window.location.search);
    var tab = urlParams.get('tab');
    var filter = urlParams.get('filter');
    var detail = urlParams.get('detail');
    
    if (tab) switchTab(tab);
    if (filter) setFilter(filter);
    renderAll();
    
    if (detail) { setTimeout(function() { openDetail(detail); }, 300); }
}

function applyAdjustments() {
    // localStorageì—ì„œ ì¬ê³ ì¡°ì • ì´ë ¥ ê°€ì ¸ì˜¤ê¸°
    var adjustmentHistory = [];
    try {
        adjustmentHistory = JSON.parse(localStorage.getItem('stockAdjustmentHistory') || '[]');
    } catch(e) {}
    
    // ê° ì¡°ì • ë‚´ì—­ ë°˜ì˜
    for (var i = 0; i < adjustmentHistory.length; i++) {
        var adj = adjustmentHistory[i];
        
        // ì™„ì œí’ˆì—ì„œ ì°¾ê¸°
        for (var j = 0; j < productData.length; j++) {
            if (productData[j].id === adj.id) {
                productData[j].stock = adj.newStock;
                break;
            }
        }
        
        // ë¶€ìì¬ì—ì„œ ì°¾ê¸°
        for (var k = 0; k < supplyData.length; k++) {
            if (supplyData[k].id === adj.id) {
                supplyData[k].stock = adj.newStock;
                // ì•ˆì „ì¬ê³  ëŒ€ë¹„ ìƒíƒœ ì—…ë°ì´íŠ¸
                supplyData[k].status = supplyData[k].stock < supplyData[k].safety ? 'low' : 'normal';
                break;
            }
        }
        
        // í¬ì¥ì¬ì—ì„œ ì°¾ê¸°
        for (var l = 0; l < packagingData.length; l++) {
            if (packagingData[l].id === adj.id) {
                packagingData[l].stock = adj.newStock;
                // ì•ˆì „ì¬ê³  ëŒ€ë¹„ ìƒíƒœ ì—…ë°ì´íŠ¸
                packagingData[l].status = packagingData[l].stock < packagingData[l].safety ? 'low' : 'normal';
                break;
            }
        }
    }
}

function switchTab(tab) {
    currentTab = tab;
    document.querySelectorAll('.tab-btn').forEach(function(btn) { btn.classList.toggle('active', btn.dataset.tab === tab); });
    document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.toggle('active', c.id === 'tab-' + tab); });
    updateFilterButtons();
    renderAll();
    // ë¶€ìì¬/í¬ì¥ì¬ íƒ­ì—ì„œëŠ” FAB ìˆ¨ê¹€
    var fabContainer = document.getElementById('fabContainer');
    if (tab === 'product') {
        fabContainer.style.display = 'block';
    } else {
        fabContainer.style.display = 'none';
    }
}

function updateFilterButtons() {
    var filterRow = document.getElementById('filterRow');
    if (currentTab === 'product') {
        filterRow.innerHTML = '<button class="filter-btn' + (currentFilter === 'all' ? ' active' : '') + '" data-filter="all" onclick="setFilter(\'all\')">ì „ì²´</button>' +
            '<button class="filter-btn' + (currentFilter === 'normal' ? ' active' : '') + '" data-filter="normal" onclick="setFilter(\'normal\')">ì •ìƒ</button>' +
            '<button class="filter-btn' + (currentFilter === 'deadline' ? ' active' : '') + '" data-filter="deadline" onclick="setFilter(\'deadline\')">ê¸°í•œì„ë°•</button>';
    } else {
        filterRow.innerHTML = '<button class="filter-btn' + (currentFilter === 'all' ? ' active' : '') + '" data-filter="all" onclick="setFilter(\'all\')">ì „ì²´</button>' +
            '<button class="filter-btn' + (currentFilter === 'normal' ? ' active' : '') + '" data-filter="normal" onclick="setFilter(\'normal\')">ì •ìƒ</button>' +
            '<button class="filter-btn' + (currentFilter === 'low' ? ' active' : '') + '" data-filter="low" onclick="setFilter(\'low\')">ë¶€ì¡±</button>';
    }
}

function setFilter(filter) {
    currentFilter = filter;
    document.querySelectorAll('.filter-btn').forEach(function(btn) { btn.classList.toggle('active', btn.dataset.filter === filter); });
    renderAll();
}

function filterStock() { renderAll(); }

function renderAll() {
    var keyword = document.getElementById('searchInput').value.toLowerCase();
    renderList('productList', productData, keyword, true);
    renderList('supplyList', supplyData, keyword, false);
    renderList('packagingList', packagingData, keyword, false);
}

function renderList(containerId, data, keyword, isProduct) {
    var filtered = data.filter(function(item) {
        var matchKeyword = !keyword || item.id.toLowerCase().indexOf(keyword) !== -1 || item.name.toLowerCase().indexOf(keyword) !== -1 || (item.customer && item.customer.toLowerCase().indexOf(keyword) !== -1);
        var matchFilter = currentFilter === 'all' || item.status === currentFilter;
        return matchKeyword && matchFilter;
    });
    
    var statusLabels = { normal: 'ì •ìƒ', low: 'ë¶€ì¡±', critical: 'ê¸´ê¸‰', deadline: 'ê¸°í•œì„ë°•' };
    
    document.getElementById(containerId).innerHTML = filtered.length === 0 ? '<div class="empty-state"><div class="empty-icon">ğŸ“¦</div><div>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>' :
        filtered.map(function(item) {
            var titleText = isProduct ? item.id + ' | ' + item.name : item.name;
            var subtitleText = isProduct ? item.customer : item.id;
            var isSelected = selectedItems.indexOf(item.id) !== -1;
            var cardClass = 'stock-card' + (isSelected ? ' selected' : '');
            var checkboxClass = 'stock-card-checkbox' + (selectMode ? ' show' : '') + (isSelected ? ' checked' : '');
            
            return '<div class="' + cardClass + '" onclick="handleCardClick(\'' + item.id + '\')">' +
                '<div class="' + checkboxClass + '">' + (isSelected ? 'âœ“' : '') + '</div>' +
                '<span class="stock-card-badge ' + item.status + '">' + statusLabels[item.status] + '</span>' +
                '<div class="stock-card-header"><div><div class="stock-card-title">' + titleText + '</div><div class="stock-card-subtitle">' + subtitleText + '</div></div></div>' +
                '<div class="stock-card-info"><div class="stock-info-item"><span class="stock-info-label">ì¬ê³ :</span><span class="stock-info-value">' + item.stock.toLocaleString() + item.unit + '</span></div>' + (item.location ? '<div class="stock-info-item"><span class="stock-info-label">ìœ„ì¹˜:</span><span class="stock-info-value">' + item.location + '</span></div>' : '') + '</div>' +
                (selectMode ? '' : '<div class="stock-card-actions"><button class="btn" onclick="event.stopPropagation();openDetail(\'' + item.id + '\')">ìƒì„¸</button><button class="btn btn-success" onclick="event.stopPropagation();openMoveModal(\'' + item.id + '\')">ì´ë™</button><button class="btn btn-primary" onclick="event.stopPropagation();goToInbound(\'' + item.id + '\')">ì…ê³ </button><button class="btn btn-warning" onclick="event.stopPropagation();goToOutbound(\'' + item.id + '\')">ì¶œê³ </button></div>') +
                '</div>';
        }).join('');
}

function handleCardClick(itemId) {
    if (selectMode) { toggleItemSelection(itemId); }
}

function toggleSelectMode() {
    selectMode = !selectMode;
    selectedItems = [];
    document.getElementById('selectModeBtn').classList.toggle('active', selectMode);
    document.getElementById('selectModeBtn').textContent = selectMode ? 'ì·¨ì†Œ' : 'ì„ íƒ';
    document.getElementById('mainContent').classList.toggle('select-mode', selectMode);
    document.getElementById('selectActions').classList.toggle('show', selectMode);
    document.getElementById('fabContainer').style.display = selectMode ? 'none' : 'block';
    renderAll();
}

function toggleItemSelection(itemId) {
    var idx = selectedItems.indexOf(itemId);
    if (idx > -1) { selectedItems.splice(idx, 1); } else { selectedItems.push(itemId); }
    renderAll();
}

function openDetail(itemId) {
    var allData = productData.concat(supplyData).concat(packagingData);
    var item = null;
    for (var i = 0; i < allData.length; i++) { if (allData[i].id === itemId) { item = allData[i]; break; } }
    if (!item) return;
    selectedItem = item;
    var statusLabels = { normal: 'ì •ìƒ', low: 'ë¶€ì¡±', critical: 'ê¸´ê¸‰', deadline: 'ê¸°í•œì„ë°•' };
    document.getElementById('detailContent').innerHTML = 
        '<div class="detail-row"><span class="detail-label">í’ˆëª©ì½”ë“œ</span><span class="detail-value">' + item.id + '</span></div>' +
        '<div class="detail-row"><span class="detail-label">í’ˆëª©ëª…</span><span class="detail-value">' + item.name + '</span></div>' +
        '<div class="detail-row"><span class="detail-label">í˜„ì¬ì¬ê³ </span><span class="detail-value" style="color:#1a73e8;">' + item.stock.toLocaleString() + item.unit + '</span></div>' +
        (item.customer ? '<div class="detail-row"><span class="detail-label">ê±°ë˜ì²˜</span><span class="detail-value">' + item.customer + '</span></div>' : '') +
        (item.location ? '<div class="detail-row"><span class="detail-label">ë³´ê´€ìœ„ì¹˜</span><span class="detail-value">' + item.location + '</span></div>' : '') +
        (item.deadline ? '<div class="detail-row"><span class="detail-label">ë³´ê´€ê¸°í•œ</span><span class="detail-value">' + item.deadline + '</span></div>' : '') +
        '<div class="detail-row"><span class="detail-label">ìƒíƒœ</span><span class="detail-value">' + statusLabels[item.status] + '</span></div>';
    document.getElementById('detailModal').classList.add('show');
}

function closeModal(id) { document.getElementById(id).classList.remove('show'); }

function openMoveModal(itemId) {
    var allData = productData.concat(supplyData).concat(packagingData);
    var item = null;
    for (var i = 0; i < allData.length; i++) { if (allData[i].id === itemId) { item = allData[i]; break; } }
    if (!item) return;
    moveTargetItemId = itemId;
    document.getElementById('singleMoveItemName').textContent = item.name;
    document.getElementById('singleMoveCurrentLoc').textContent = item.location || 'ë¯¸ì§€ì •';
    document.getElementById('singleMoveLocation').value = '';
    document.getElementById('singleMoveModal').classList.add('show');
}

function confirmSingleMove() {
    var newLoc = document.getElementById('singleMoveLocation').value;
    if (!newLoc) { showToast('ì´ë™í•  ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
    
    var allData = productData.concat(supplyData).concat(packagingData);
    for (var i = 0; i < allData.length; i++) {
        if (allData[i].id === moveTargetItemId) { allData[i].location = newLoc; break; }
    }
    
    showToast('ìœ„ì¹˜ê°€ ' + newLoc + '(ìœ¼)ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤');
    closeModal('singleMoveModal');
    renderAll();
}

function goToInbound(id) {
    var allData = productData.concat(supplyData).concat(packagingData);
    var item = null;
    for (var i = 0; i < allData.length; i++) { if (allData[i].id === id) { item = allData[i]; break; } }
    if (item) {
        var itemData = encodeURIComponent(JSON.stringify(item));
        location.href = 'm_9_2_0.html?addItem=' + itemData;
    } else {
        location.href = 'm_9_2_0.html?code=' + id;
    }
}
function goToOutbound(id) {
    var allData = productData.concat(supplyData).concat(packagingData);
    var item = null;
    for (var i = 0; i < allData.length; i++) { if (allData[i].id === id) { item = allData[i]; break; } }
    if (item) {
        var itemData = encodeURIComponent(JSON.stringify(item));
        location.href = 'm_9_3_0.html?addItem=' + itemData;
    } else {
        location.href = 'm_9_3_0.html?code=' + id;
    }
}
function goToMoveFromModal() { if (selectedItem) { closeModal('detailModal'); openMoveModal(selectedItem.id); } }
function goToInboundFromModal() { if (selectedItem) { closeModal('detailModal'); goToInbound(selectedItem.id); } }
function goToOutboundFromModal() { if (selectedItem) { closeModal('detailModal'); goToOutbound(selectedItem.id); } }

function toggleFab() {
    fabOpen = !fabOpen;
    document.getElementById('fabBtn').classList.toggle('open', fabOpen);
    document.getElementById('fabMenu').classList.toggle('show', fabOpen);
}

function openQuickAdd() {
    toggleFab();
    document.getElementById('quickType').value = currentTab;
    document.getElementById('quickName').value = '';
    document.getElementById('quickCode').value = '';
    document.getElementById('quickCustomer').value = '';
    document.getElementById('quickQty').value = '';
    document.getElementById('quickUnit').value = currentTab === 'product' ? 'ë¶€' : (currentTab === 'supply' ? 'kg' : 'ê°œ');
    document.getElementById('quickLocBuilding').value = '';
    document.getElementById('quickLocZone').value = '';
    document.getElementById('quickLocShelf').value = '';
    document.getElementById('quickCustomerGroup').style.display = currentTab === 'product' ? 'block' : 'none';
    document.getElementById('quickAddModal').classList.add('show');
}

document.getElementById('quickType').addEventListener('change', function() {
    var type = this.value;
    document.getElementById('quickUnit').value = type === 'product' ? 'ë¶€' : (type === 'supply' ? 'kg' : 'ê°œ');
    document.getElementById('quickCustomerGroup').style.display = type === 'product' ? 'block' : 'none';
});

function submitQuickAdd() {
    var type = document.getElementById('quickType').value;
    var name = document.getElementById('quickName').value.trim();
    var code = document.getElementById('quickCode').value.trim();
    var customer = document.getElementById('quickCustomer').value.trim();
    var qty = parseInt(document.getElementById('quickQty').value);
    var unit = document.getElementById('quickUnit').value.trim();
    var locB = document.getElementById('quickLocBuilding').value;
    var locZ = document.getElementById('quickLocZone').value;
    var locS = document.getElementById('quickLocShelf').value;
    
    if (!name || !qty) { showToast('í’ˆëª©ëª…ê³¼ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
    
    var location = '';
    if (locB && locZ && locS) { location = locB + '-' + locZ + '-' + locS; }
    
    var newItem = {
        id: code || ('NEW-' + Date.now()),
        name: name,
        stock: qty,
        unit: unit || 'ê°œ',
        location: location,
        status: 'normal'
    };
    
    if (type === 'product') {
        newItem.customer = customer || '';
        newItem.deadline = '';
        productData.unshift(newItem);
    } else if (type === 'supply') {
        newItem.safety = Math.floor(qty * 0.3);
        supplyData.unshift(newItem);
    } else {
        newItem.safety = Math.floor(qty * 0.3);
        packagingData.unshift(newItem);
    }
    
    showToast('í’ˆëª© ë“±ë¡ ì™„ë£Œ: ' + name);
    closeModal('quickAddModal');
    switchTab(type);
}

function bulkMove() {
    if (selectedItems.length === 0) { showToast('í’ˆëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
    document.getElementById('moveCount').textContent = selectedItems.length + 'ê±´ ì„ íƒë¨';
    document.getElementById('bulkMoveModal').classList.add('show');
}

function bulkOutbound() {
    if (selectedItems.length === 0) { showToast('í’ˆëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
    document.getElementById('outCount').textContent = selectedItems.length + 'ê±´ ì„ íƒë¨';
    document.getElementById('bulkOutModal').classList.add('show');
}

function bulkDeadline() {
    if (selectedItems.length === 0) { showToast('í’ˆëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
    document.getElementById('deadlineCount').textContent = selectedItems.length + 'ê±´ ì„ íƒë¨';
    document.getElementById('bulkDeadlineModal').classList.add('show');
}

function confirmBulkMove() {
    var loc = document.getElementById('bulkMoveLocation').value;
    if (!loc) { showToast('ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
    
    var allData = productData.concat(supplyData).concat(packagingData);
    selectedItems.forEach(function(itemId) {
        for (var i = 0; i < allData.length; i++) {
            if (allData[i].id === itemId) { allData[i].location = loc; break; }
        }
    });
    
    showToast(selectedItems.length + 'ê±´ ìœ„ì¹˜ ì´ë™ ì™„ë£Œ');
    closeModal('bulkMoveModal');
    toggleSelectMode();
}

function confirmBulkOut() {
    var allData = productData.concat(supplyData).concat(packagingData);
    var selectedItemsData = [];
    selectedItems.forEach(function(itemId) {
        for (var i = 0; i < allData.length; i++) {
            if (allData[i].id === itemId) {
                selectedItemsData.push(allData[i]);
                break;
            }
        }
    });
    
    var itemsParam = encodeURIComponent(JSON.stringify(selectedItemsData));
    closeModal('bulkOutModal');
    location.href = 'm_9_3_0.html?bulkItems=' + itemsParam;
}

function confirmBulkDeadline() {
    var date = document.getElementById('bulkDeadlineDate').value;
    if (!date) { showToast('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
    
    // ì„ íƒëœ í’ˆëª©ë“¤ì˜ ë³´ê´€ê¸°í•œ ì—…ë°ì´íŠ¸
    selectedItems.forEach(function(itemId) {
        for (var i = 0; i < productData.length; i++) {
            if (productData[i].id === itemId) {
                productData[i].deadline = date;
                // ê¸°í•œì´ 7ì¼ ì´ë‚´ì¸ì§€ í™•ì¸í•˜ì—¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                var today = new Date();
                var deadlineDate = new Date(date);
                var diffDays = Math.ceil((deadlineDate - today) / (1000 * 60 * 60 * 24));
                if (diffDays <= 7) {
                    productData[i].status = 'deadline';
                } else {
                    productData[i].status = 'normal';
                }
                break;
            }
        }
    });
    
    showToast(selectedItems.length + 'ê±´ ê¸°í•œ ìˆ˜ì • ì™„ë£Œ: ' + date);
    closeModal('bulkDeadlineModal');
    toggleSelectMode();
    renderAll();
}

function showToast(msg) {
    var t = document.querySelector('.toast');
    if (!t) { t = document.createElement('div'); t.className = 'toast'; document.body.appendChild(t); }
    t.textContent = msg;
    t.style.opacity = '1';
    setTimeout(function() { t.style.opacity = '0'; }, 2000);
}

document.addEventListener('DOMContentLoaded', initPage);
document.addEventListener('click', function(e) { if (fabOpen && !e.target.closest('.fab-container')) toggleFab(); });
</script>
</body>
</html>
